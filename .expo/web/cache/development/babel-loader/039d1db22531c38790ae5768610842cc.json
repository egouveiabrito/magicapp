{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = Search;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _api = _interopRequireDefault(require(\"../services/api\"));\n\nvar _reactNative = require(\"react-native\");\n\nvar _LazyImage = _interopRequireDefault(require(\"../components/LazyImage\"));\n\nvar _styled = require(\"../components/Search/styled\");\n\nvar _jsxFileName = \"C:\\\\React\\\\magic\\\\src\\\\pages\\\\Search.js\";\n\nvar _Dimensions$get = _reactNative.Dimensions.get(\"window\"),\n    width = _Dimensions$get.width;\n\nvar styles = require('../pages/styles');\n\nvar PADDING = 16;\nvar SEARCH_FULL_WIDTH = width - PADDING * 2;\nvar SEARCH_SHRINK_WIDTH = width - PADDING - 90;\n\nvar AnimatedTouchable = _reactNative.Animated.createAnimatedComponent(_reactNative.TouchableOpacity);\n\nfunction Search() {\n  var _this = this;\n\n  var _useState = (0, _react.useState)([]),\n      _useState2 = (0, _slicedToArray2.default)(_useState, 2),\n      docs = _useState2[0],\n      setDocs = _useState2[1];\n\n  var _useState3 = (0, _react.useState)(1),\n      _useState4 = (0, _slicedToArray2.default)(_useState3, 2),\n      page = _useState4[0],\n      setPage = _useState4[1];\n\n  var _useState5 = (0, _react.useState)(0),\n      _useState6 = (0, _slicedToArray2.default)(_useState5, 2),\n      total = _useState6[0],\n      setTotal = _useState6[1];\n\n  var _useState7 = (0, _react.useState)([]),\n      _useState8 = (0, _slicedToArray2.default)(_useState7, 2),\n      viewable = _useState8[0],\n      setViewable = _useState8[1];\n\n  var _useState9 = (0, _react.useState)(false),\n      _useState10 = (0, _slicedToArray2.default)(_useState9, 2),\n      loading = _useState10[0],\n      setLoading = _useState10[1];\n\n  var _useState11 = (0, _react.useState)(false),\n      _useState12 = (0, _slicedToArray2.default)(_useState11, 2),\n      refreshing = _useState12[0],\n      setRefreshing = _useState12[1];\n\n  var _useState13 = (0, _react.useState)(new _reactNative.Animated.Value(SEARCH_FULL_WIDTH)),\n      _useState14 = (0, _slicedToArray2.default)(_useState13, 1),\n      inputLength = _useState14[0];\n\n  var _useState15 = (0, _react.useState)(new _reactNative.Animated.Value(SEARCH_FULL_WIDTH)),\n      _useState16 = (0, _slicedToArray2.default)(_useState15, 1),\n      cancelPosition = _useState16[0];\n\n  var _useState17 = (0, _react.useState)(new _reactNative.Animated.Value(0)),\n      _useState18 = (0, _slicedToArray2.default)(_useState17, 1),\n      opacity = _useState18[0];\n\n  var _useState19 = (0, _react.useState)(false),\n      _useState20 = (0, _slicedToArray2.default)(_useState19, 1),\n      searchBarFocused = _useState20[0];\n\n  (0, _react.useEffect)(function () {\n    loadPage();\n  }, []);\n\n  function validadeJson(Info) {\n    try {\n      var Cards = new Array();\n\n      for (var index = 0; index < Info.data.length; index++) {\n        Cards.push({\n          _id: Info.data[index].id,\n          title: Info.data[index].name + ' - ' + Info.data[index].type_line,\n          url: Info.data[index].image_uris == undefined ? 'https://www.buritama.sp.leg.br/imagens/parlamentares-2013-2016/sem-foto.jpg/image' : Info.data[index].image_uris.normal,\n          description: Info.data[index].oracle_text\n        });\n      }\n\n      return Cards;\n    } catch (error) {\n      console.log(error);\n    }\n  }\n\n  function loadPage() {\n    var pageNumber,\n        shouldRefresh,\n        response,\n        data,\n        _args = arguments;\n    return _regenerator.default.async(function loadPage$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            pageNumber = _args.length > 0 && _args[0] !== undefined ? _args[0] : page;\n            shouldRefresh = _args.length > 1 && _args[1] !== undefined ? _args[1] : false;\n\n            if (!(pageNumber === total)) {\n              _context.next = 4;\n              break;\n            }\n\n            return _context.abrupt(\"return\");\n\n          case 4:\n            if (!loading) {\n              _context.next = 6;\n              break;\n            }\n\n            return _context.abrupt(\"return\");\n\n          case 6:\n            setLoading(true);\n            _context.prev = 7;\n            _context.next = 10;\n            return _regenerator.default.awrap(_api.default.get('/cards?page=' + page));\n\n          case 10:\n            response = _context.sent;\n            data = validadeJson(response.data);\n            setLoading(false);\n            setTotal(Math.floor(data.length / 4));\n            setPage(pageNumber + 1);\n            setDocs(shouldRefresh ? data : [].concat((0, _toConsumableArray2.default)(docs), (0, _toConsumableArray2.default)(data)));\n            _context.next = 21;\n            break;\n\n          case 18:\n            _context.prev = 18;\n            _context.t0 = _context[\"catch\"](7);\n            console.log(_context.t0.message);\n\n          case 21:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[7, 18]], Promise);\n  }\n\n  function search(search) {\n    var response, data;\n    return _regenerator.default.async(function search$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            if (!(search.length <= 3)) {\n              _context2.next = 2;\n              break;\n            }\n\n            return _context2.abrupt(\"return\");\n\n          case 2:\n            _context2.prev = 2;\n            _context2.next = 5;\n            return _regenerator.default.awrap(_api.default.get('/cards/search?q=' + search));\n\n          case 5:\n            response = _context2.sent;\n            data = validadeJson(response.data);\n            setTotal(Math.floor(data.length / 4));\n            setPage(1);\n            setDocs(data);\n            _context2.next = 15;\n            break;\n\n          case 12:\n            _context2.prev = 12;\n            _context2.t0 = _context2[\"catch\"](2);\n            console.log(_context2.t0.message);\n\n          case 15:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[2, 12]], Promise);\n  }\n\n  function refreshList() {\n    return _regenerator.default.async(function refreshList$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            setRefreshing(true);\n            _context3.next = 3;\n            return _regenerator.default.awrap(loadPage(1, true));\n\n          case 3:\n            setRefreshing(false);\n\n          case 4:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }\n\n  var handleViewableChanged = (0, _react.useCallback)(function (_ref) {\n    var changed = _ref.changed;\n\n    try {\n      setViewable(changed.map(function (_ref2) {\n        var item = _ref2.item;\n        return item._id;\n      }));\n    } catch (error) {\n      console.log(error);\n    }\n  }, []);\n\n  function onFocus() {\n    _reactNative.Animated.parallel([_reactNative.Animated.timing(inputLength, {\n      toValue: SEARCH_SHRINK_WIDTH,\n      duration: 250\n    }), _reactNative.Animated.timing(cancelPosition, {\n      toValue: 16,\n      duration: 400\n    }), _reactNative.Animated.timing(opacity, {\n      toValue: 1,\n      duration: 250\n    })]).start();\n  }\n\n  function onBlur() {\n    _reactNative.Animated.parallel([_reactNative.Animated.timing(inputLength, {\n      toValue: SEARCH_FULL_WIDTH,\n      duration: 250\n    }), _reactNative.Animated.timing(cancelPosition, {\n      toValue: 0,\n      duration: 250\n    }), _reactNative.Animated.timing(opacity, {\n      toValue: 0,\n      duration: 250\n    })]).start();\n  }\n\n  return _react.default.createElement(_reactNative.View, {\n    style: styles.container,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143\n    }\n  }, _react.default.createElement(_reactNative.View, {\n    style: styles.searchContainer,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144\n    }\n  }, _react.default.createElement(_reactNative.Animated.View, {\n    style: [styles.search, {\n      width: inputLength,\n      position: \"absolute\",\n      left: 16,\n      alignSelf: \"center\"\n    }, searchBarFocused === true ? undefined : {\n      justifyContent: \"center\"\n    }],\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145\n    }\n  }, _react.default.createElement(_reactNative.TextInput, {\n    style: styles.searchInput,\n    onBlur: onBlur,\n    onFocus: onFocus,\n    onChangeText: search.bind(this),\n    placeholder: \"Type something\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157\n    }\n  })), _react.default.createElement(AnimatedTouchable, {\n    style: [styles.cancelSearch, {\n      right: cancelPosition\n    }],\n    onPress: function onPress() {\n      return null;\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166\n    }\n  }, _react.default.createElement(_reactNative.Animated.Text, {\n    style: [styles.cancelSearchText, {\n      opacity: opacity\n    }],\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170\n    }\n  }))), _react.default.createElement(_reactNative.FlatList, {\n    key: \"list\",\n    data: docs,\n    keyExtractor: function keyExtractor(item) {\n      return String(item._id);\n    },\n    onViewableItemsChanged: handleViewableChanged,\n    viewabilityConfig: {\n      viewAreaCoveragePercentThreshold: 50\n    },\n    showsVerticalScrollIndicator: false,\n    onRefresh: refreshList,\n    refreshing: refreshing,\n    onEndReachedThreshold: 0.1,\n    onEndReached: function onEndReached() {\n      return loadPage();\n    },\n    renderItem: function renderItem(_ref3) {\n      var item = _ref3.item;\n      return _react.default.createElement(_styled.Post, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 191\n        }\n      }, _react.default.createElement(_styled.Header, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192\n        }\n      }, _react.default.createElement(_styled.Avatar, {\n        source: {\n          uri: item.url\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193\n        }\n      }), _react.default.createElement(_styled.Name, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 194\n        }\n      }, item.title)), _react.default.createElement(_LazyImage.default, {\n        aspectRatio: 0.834,\n        shouldLoad: viewable.includes(item._id),\n        smallSource: {\n          uri: item.url\n        },\n        source: {\n          uri: item.url\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 198\n        }\n      }), _react.default.createElement(_reactNative.View, {\n        style: styles.searchContainer,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 207\n        }\n      }, _react.default.createElement(_reactNative.Animated.View, {\n        style: [styles.search, {\n          width: inputLength,\n          position: \"absolute\",\n          left: 16,\n          alignSelf: \"center\"\n        }, searchBarFocused === true ? undefined : {\n          justifyContent: \"center\"\n        }],\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 208\n        }\n      }, _react.default.createElement(_reactNative.TouchableOpacity, {\n        style: styles.productsButton,\n        onPress: function onPress() {\n          _this.props.navigation.navigate('Card');\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 220\n        }\n      }, _react.default.createElement(_reactNative.Text, {\n        style: styles.productsButtonText,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 225\n        }\n      }, \"Add\")))));\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177\n    }\n  }));\n}","map":{"version":3,"sources":["C:/React/magic/src/pages/Search.js"],"names":["Dimensions","get","width","styles","require","PADDING","SEARCH_FULL_WIDTH","SEARCH_SHRINK_WIDTH","AnimatedTouchable","Animated","createAnimatedComponent","TouchableOpacity","Search","docs","setDocs","page","setPage","total","setTotal","viewable","setViewable","loading","setLoading","refreshing","setRefreshing","Value","inputLength","cancelPosition","opacity","searchBarFocused","loadPage","validadeJson","Info","Cards","Array","index","data","length","push","_id","id","title","name","type_line","url","image_uris","undefined","normal","description","oracle_text","error","console","log","pageNumber","shouldRefresh","api","response","Math","floor","message","search","refreshList","handleViewableChanged","changed","map","item","onFocus","parallel","timing","toValue","duration","start","onBlur","container","searchContainer","position","left","alignSelf","justifyContent","searchInput","bind","cancelSearch","right","cancelSearchText","String","viewAreaCoveragePercentThreshold","uri","includes","productsButton","props","navigation","navigate","productsButtonText"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\r\nimport api from '../services/api';\r\nimport { View, Text, TouchableOpacity, TextInput, Dimensions, Animated, FlatList } from 'react-native';\r\nconst { width } = Dimensions.get(\"window\");\r\nvar styles = require('../pages/styles');\r\n\r\nimport LazyImage from '../components/LazyImage';\r\nimport { Post, Header, Avatar, Name, Description } from '../components/Search/styled';\r\n\r\n\r\nconst PADDING = 16;\r\nconst SEARCH_FULL_WIDTH = width - PADDING * 2; //search_width when unfocused\r\nconst SEARCH_SHRINK_WIDTH = width - PADDING - 90; //search_width when focused\r\nconst AnimatedTouchable = Animated.createAnimatedComponent(TouchableOpacity);\r\n\r\n\r\nexport default function Search() {\r\n    \r\n        const [docs, setDocs] = useState([]);\r\n        const [page, setPage] = useState(1);\r\n        const [total, setTotal] = useState(0);\r\n        const [viewable, setViewable] = useState([]);\r\n        const [loading, setLoading] = useState(false);\r\n        const [refreshing, setRefreshing] = useState(false);\r\n        const [inputLength] = useState(new Animated.Value(SEARCH_FULL_WIDTH));\r\n        const [cancelPosition] = useState(new Animated.Value(SEARCH_FULL_WIDTH));\r\n        const [opacity] = useState(new Animated.Value(0));\r\n        const [searchBarFocused] = useState(false);\r\n\r\n        useEffect(() => { loadPage() }, []);\r\n\r\n        function validadeJson(Info){\r\n        try {\r\n            var Cards = new Array();\r\n            for (let index = 0; index < Info.data.length; index++) {\r\n                Cards.push( {\r\n                    _id: Info.data[index].id,\r\n                    title: Info.data[index].name + ' - ' + Info.data[index].type_line,\r\n                    url: Info.data[index].image_uris == undefined ? 'https://www.buritama.sp.leg.br/imagens/parlamentares-2013-2016/sem-foto.jpg/image' :\r\n                        Info.data[index].image_uris.normal,\r\n                    description: Info.data[index].oracle_text\r\n                });\r\n            }\r\n           return Cards;\r\n\r\n        } catch (error) {\r\n            console.log(error);\r\n        }\r\n        }\r\n\r\n        async function loadPage(pageNumber = page, shouldRefresh = false) {\r\n\r\n            if (pageNumber === total) return;\r\n            if (loading) return;\r\n\r\n            setLoading(true);\r\n\r\n            try {\r\n                const response = await api.get('/cards?page=' + page);\r\n                const data = validadeJson(response.data);\r\n\r\n                setLoading(false);\r\n                setTotal(Math.floor(data.length / 4));\r\n                setPage(pageNumber + 1);\r\n                setDocs(shouldRefresh ? data : [...docs, ...data]);\r\n\r\n            } catch (error) {\r\n                console.log(error.message);\r\n            }\r\n        }\r\n\r\n        async function search(search) {\r\n            \r\n            if (search.length <= 3) return;\r\n\r\n        try {\r\n\r\n            const response = await api.get('/cards/search?q=' + search);\r\n            const data = validadeJson(response.data);\r\n            \r\n            setTotal(Math.floor(data.length / 4));\r\n            setPage(1);\r\n            setDocs(data);\r\n\r\n        } catch (error) {\r\n            console.log(error.message);\r\n        }\r\n        }\r\n\r\n        async function refreshList() {\r\n            setRefreshing(true);\r\n\r\n            await loadPage(1, true);\r\n\r\n            setRefreshing(false);\r\n        }\r\n\r\n        const handleViewableChanged = useCallback(({ changed }) => {\r\n                try {\r\n                    setViewable(changed.map(({ item }) => item._id));\r\n\r\n                } catch (error) {\r\n                    console.log(error);\r\n                }\r\n        \r\n        }, []);\r\n\r\n        function onFocus() {\r\n            Animated.parallel([\r\n                Animated.timing(inputLength, {\r\n                    toValue: SEARCH_SHRINK_WIDTH,\r\n                    duration: 250\r\n                }),\r\n                Animated.timing(cancelPosition, {\r\n                    toValue: 16,\r\n                    duration: 400\r\n                }),\r\n                Animated.timing(opacity, {\r\n                    toValue: 1,\r\n                    duration: 250\r\n                })\r\n            ]).start();\r\n        }\r\n\r\n        function onBlur() {\r\n            Animated.parallel([\r\n                Animated.timing(inputLength, {\r\n                    toValue: SEARCH_FULL_WIDTH,\r\n                    duration: 250\r\n                }),\r\n                Animated.timing(cancelPosition, {\r\n                    toValue: 0,\r\n                    duration: 250\r\n                }),\r\n                Animated.timing(opacity, {\r\n                    toValue: 0,\r\n                    duration: 250\r\n                })\r\n            ]).start();\r\n        }\r\n        \r\n    return (\r\n                <View style={styles.container}>\r\n                    <View style={styles.searchContainer}>\r\n                        <Animated.View\r\n                            style={[\r\n                                styles.search,\r\n                                {\r\n                                    width: inputLength,\r\n                                    position: \"absolute\",\r\n                                    left: 16,\r\n                                    alignSelf: \"center\"\r\n                                },\r\n                                searchBarFocused === true ? undefined : { justifyContent: \"center\" }\r\n                            ]}\r\n                        >\r\n                            <TextInput\r\n                                style={styles.searchInput}\r\n                                onBlur={onBlur}\r\n                                onFocus={onFocus}\r\n                                onChangeText={search.bind(this)}\r\n                                placeholder=\"Type something\"\r\n                            />\r\n                        </Animated.View>\r\n\r\n                        <AnimatedTouchable\r\n                            style={[styles.cancelSearch, { right: cancelPosition }]}\r\n                            onPress={() => null}>\r\n\r\n                            <Animated.Text\r\n                                style={[styles.cancelSearchText, { opacity: opacity }]}>\r\n                            </Animated.Text>\r\n\r\n                        </AnimatedTouchable>\r\n                    </View>\r\n\r\n               <FlatList\r\n                    key=\"list\"\r\n                    data={docs}\r\n                    keyExtractor={item => String(item._id)}\r\n                    onViewableItemsChanged={handleViewableChanged}\r\n                    viewabilityConfig={{\r\n                        viewAreaCoveragePercentThreshold: 50,\r\n                    }}\r\n                    showsVerticalScrollIndicator={false}\r\n                    onRefresh={refreshList}\r\n                    refreshing={refreshing}\r\n                    onEndReachedThreshold={0.1}\r\n                    onEndReached={() => loadPage()}\r\n                    renderItem={({ item }) => (\r\n                        <Post>\r\n                            <Header>\r\n                                <Avatar source={{ uri: item.url }} />\r\n                                <Name>{item.title}</Name>\r\n                            </Header>\r\n                        \r\n              \r\n                            <LazyImage \r\n                                aspectRatio={0.834}\r\n                                shouldLoad={viewable.includes(item._id)}\r\n                                smallSource={{ uri: item.url }}\r\n                                source={{ uri: item.url }}\r\n                            />   \r\n\r\n\r\n\r\n                            <View style={styles.searchContainer}>\r\n                                <Animated.View\r\n                                    style={[\r\n                                        styles.search,\r\n                                        {\r\n                                            width: inputLength,\r\n                                            position: \"absolute\",\r\n                                            left: 16,\r\n                                            alignSelf: \"center\"\r\n                                        },\r\n                                        searchBarFocused === true ? undefined : { justifyContent: \"center\" }\r\n                                    ]}\r\n                                >\r\n                                    <TouchableOpacity\r\n                                        style={styles.productsButton}\r\n                                        onPress={() => {\r\n                                            this.props.navigation.navigate('Card');\r\n                                        }}>\r\n                                        <Text style={styles.productsButtonText}>Add</Text>\r\n                                    </TouchableOpacity>\r\n                                </Animated.View>\r\n\r\n                              \r\n                            </View> \r\n                          \r\n                        </Post>\r\n                )}\r\n            />\r\n    </View>\r\n    );\r\n}"]},"metadata":{},"sourceType":"script"}